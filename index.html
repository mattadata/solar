<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Solar Dashboard</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #f0f0f0; padding: 20px; }
        .value { font-size: 1.5em; margin: 10px 0; }
        .status { font-size: 1em; color: #555; }
    </style>
</head>
<body>
    <h1>Real Time Solar Dashboard</h1>
    <div id="status" class="status">Connecting to MQTT broker...</div>
    <div id="bat_v" class="value">Battery Voltage: -- V</div>
    <div id="watts" class="value">Solar Watts: -- W</div>
    <div id="battery_power" class="value">Battery Power: -- W</div>
    <div id="soc" class="value">State of Charge: -- %</div>

    <script>
        const brokerUrl = 'wss://test.mosquitto.org:8081/mqtt';
        const clientId = 'mqtt-dashboard-' + Math.random().toString(16).slice(2, 8);
        const client = mqtt.connect(brokerUrl, { clientId });

        const statusElement = document.getElementById('status');

        client.on('connect', () => {
            statusElement.textContent = 'Connected to MQTT broker';
            console.log('Connected to MQTT broker');

            // Subscribe to your specific topics
            client.subscribe('my/topic/bat_v');
            client.subscribe('my/topic/watts');
            client.subscribe('my/topic/battery_power');
            client.subscribe('my/topic/soc');
        });

        client.on('message', (topic, message) => {
            const value = message.toString();
            console.log(`Received message on topic ${topic}: ${value}`);
            switch (topic) {
                case 'my/topic/bat_v':
                    document.getElementById('bat_v').textContent = `Battery Voltage: ${value} V`;
                    break;
                case 'my/topic/watts':
                    document.getElementById('watts').textContent = `Solar Watts: ${value} W`;
                    break;
                case 'my/topic/battery_power':
                    document.getElementById('battery_power').textContent = `Battery Power: ${value} W`;
                    break;
                case 'my/topic/soc':
                    document.getElementById('soc').textContent = `State of Charge: ${value} %`;
                    break;
            }
        });

        client.on('error', (error) => {
            statusElement.textContent = `MQTT Error: ${error.message}`;
            console.error('MQTT Error:', error);
        });

        client.on('reconnect', () => {
            statusElement.textContent = 'Reconnecting to MQTT broker...';
            console.log('Reconnecting to broker...');
        });

        client.on('offline', () => {
            statusElement.textContent = 'MQTT broker is offline';
            console.log('Broker is offline');
        });

        client.on('close', () => {
            statusElement.textContent = 'Disconnected from MQTT broker';
            console.log('Disconnected from broker');
        });
    </script>
</body>
</html>
